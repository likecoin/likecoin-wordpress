!function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e,n,r,l=t(function(t){var e=function(i){var s,t=Object.prototype,u=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function a(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(t){a=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o,a,i,c,e=e&&e.prototype instanceof w?e:w,e=Object.create(e.prototype),r=new L(r||[]);return e._invoke=(o=t,a=n,i=r,c=l,function(t,e){if(c===f)throw new Error("Generator is already running");if(c===d){if("throw"===t)throw e;return I()}for(i.method=t,i.arg=e;;){var n=i.delegate;if(n){var r=function t(e,n){var r=e.iterator[n.method];if(r===s){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=s,t(e,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}r=p(r,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;var r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y;{if(!r.done)return r;n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=s)}n.delegate=null;return y}(n,i);if(r){if(r===y)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(c===l)throw c=d,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);c=f;r=p(o,a,i);if("normal"===r.type){if(c=i.done?d:h,r.arg!==y)return{value:r.arg,done:i.done}}else"throw"===r.type&&(c=d,i.method="throw",i.arg=r.arg)}}),e}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}i.wrap=c;var l="suspendedStart",h="suspendedYield",f="executing",d="completed",y={};function w(){}function g(){}function v(){}var m={};m[r]=function(){return this};e=Object.getPrototypeOf,e=e&&e(e(_([])));e&&e!==t&&u.call(e,r)&&(m=e);var b=v.prototype=w.prototype=Object.create(m);function x(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function S(i,c){var e;this._invoke=function(n,r){function t(){return new c(function(t,e){!function e(t,n,r,o){t=p(i[t],i,n);if("throw"!==t.type){var a=t.arg,n=a.value;return n&&"object"==typeof n&&u.call(n,"__await")?c.resolve(n.__await).then(function(t){e("next",t,r,o)},function(t){e("throw",t,r,o)}):c.resolve(n).then(function(t){a.value=t,r(a)},function(t){return e("throw",t,r,o)})}o(t.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,t=function t(){for(;++n<e.length;)if(u.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=s,t.done=!0,t};return t.next=t}}return{next:I}}function I(){return{value:s,done:!0}}return((g.prototype=b.constructor=v).constructor=g).displayName=a(v,o,"GeneratorFunction"),i.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,a(t,o,"GeneratorFunction")),t.prototype=Object.create(b),t},i.awrap=function(t){return{__await:t}},x(S.prototype),S.prototype[n]=function(){return this},i.AsyncIterator=S,i.async=function(t,e,n,r,o){void 0===o&&(o=Promise);var a=new S(c(t,e,n,r),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},x(b),a(b,o,"Generator"),b[r]=function(){return this},b.toString=function(){return"[object Generator]"},i.keys=function(n){var t,r=[];for(t in n)r.push(t);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=_,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=s)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return a.type="throw",a.arg=n,r.next=t,e&&(r.method="next",r.arg=s),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&u.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r,o=n.completion;return"throw"===o.type&&(r=o.arg,E(n)),r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=s),y}},i}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}),o=t(function(t){function s(t,e,n,r,o,a,i){try{var c=t[a](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}t.exports=function(c){return function(){var t=this,i=arguments;return new Promise(function(e,n){var r=c.apply(t,i);function o(t){s(r,e,n,o,a,"next",t)}function a(t){s(r,e,n,o,a,"throw",t)}o(void 0)})}},t.exports.default=t.exports,t.exports.__esModule=!0}),a=(r=o)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;function i(t){return c.apply(this,arguments)}function c(){return(c=a(l.mark(function t(e){var n,r,o,a,i,c;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),n=document.querySelector("#lcMattersStatus"),r=document.querySelector("#lcIPFSStatus"),t.next=5,jQuery.ajax({type:"POST",url:"".concat(wpApiSettings.root,"likecoin/v1/posts/").concat(wpApiSettings.postId,"/publish/refresh"),method:"POST",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}});case 5:o=t.sent,i=o.matters,c=o.ipfs,i.url?(o=i.url,a=i.status,n.innerHTML='<a rel="noopener" target="_blank" href="'.concat(o,'">').concat(a,"</a>")):n.textContent=i.status,c.url?(a=c.url,i=c.status,r.innerHTML='<a rel="noopener" target="_blank" href="'.concat(a,'">').concat(i,"</a>")):r.textContent=c.status,c.hash&&(lcPostInfo.ipfsHash=c.hash,(c=document.getElementById("lcISCNPublish"))&&(c.style.display=""));case 10:case"end":return t.stop()}},t)}))).apply(this,arguments)}function h(t){return s.apply(this,arguments)}function s(){return(s=a(l.mark(function t(e){var n,r,o,a,i,c;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("https://like.co"!==e.origin)return t.abrupt("return");t.next=2;break;case 2:if(r=JSON.parse(e.data),n=r.action,r=r.data,"ISCN_SUBMITTED"!==n)return t.abrupt("return");t.next=5;break;case 5:if(o=r.tx_hash,c=r.error,i=r.success,c||!1===i)return t.abrupt("return");t.next=8;break;case 8:return a=document.querySelector("#lcISCNStatus"),t.next=11,jQuery.ajax({type:"POST",url:"".concat(wpApiSettings.root,"likecoin/v1/posts/").concat(wpApiSettings.postId,"/publish/iscn"),dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify({iscnHash:o}),method:"POST",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}});case 11:c=t.sent,i=c.url,c=c.status,a.innerHTML='<a rel="noopener" target="_blank" href="'.concat(i,'">').concat(c,"</a>");case 14:case"end":return t.stop()}},t)}))).apply(this,arguments)}function u(t){return p.apply(this,arguments)}function p(){return(p=a(l.mark(function t(e){var n,r,o,a,i;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("https://like.co"!==e.origin)return t.abrupt("return");t.next=2;break;case 2:if(t.prev=2,o=JSON.parse(e.data),a=o.action,n=o.data,"TX_FEE_SUBMITTED"!==a)return t.abrupt("return");t.next=6;break;case 6:if(r=n.tx_hash,o=n.error,a=n.success,o||!1===a)return t.abrupt("return");t.next=9;break;case 9:return t.next=11,jQuery.ajax({type:"POST",url:"".concat(wpApiSettings.root,"likecoin/v1/posts/").concat(wpApiSettings.postId,"/arweave/upload"),dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify({txHash:r}),method:"POST",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}});case 11:if((i=t.sent).data){t.next=15;break}return window.alert("Something went wrong when uploading to Arweave. Please re-submit."),t.abrupt("return");case 15:i.data.arweaveId&&i.data.ipfsHash&&f(i.data),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(2),console.error("Error occurs when uploading to Arweave: ".concat(t.t0.message));case 21:case"end":return t.stop()}},t,null,[[2,18]])}))).apply(this,arguments)}function f(){return d.apply(this,arguments)}function d(){return(d=a(l.mark(function t(e){var n,r,o,a,i,c,s,u,p;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=lcPostInfo,n=s.title,r=s.tags,o=s.url,p=e.arweaveId,u=wpApiSettings,a=u.siteurl,i=e.ipfsHash,p&&i){t.next=6;break}return t.abrupt("return");case 6:c=encodeURIComponent(n),s=(r||[]).join(","),u=encodeURIComponent(o),p=encodeURIComponent(a),p="https://like.co/in/widget/iscn?fingerprint=".concat(i,"&publisher=matters&title=").concat(c,"&tags=").concat(s,"&opener=1&url=").concat(u,"&redirect_uri=").concat(p),window.open(p,"_blank","menubar=no,location=no,width=576,height=768"),window.addEventListener("message",h,!1);case 14:case"end":return t.stop()}},t)}))).apply(this,arguments)}function y(t){t.preventDefault();var e=lcPostInfo,n=e.title,r=e.ipfsHash,o=e.tags,t=e.url,e=wpApiSettings.siteurl;r&&(n=encodeURIComponent(n),o=(o||[]).join(","),t=encodeURIComponent(t),e=encodeURIComponent(e),e="https://like.co/in/widget/iscn?fingerprint=".concat(r,"&publisher=matters&title=").concat(n,"&tags=").concat(o,"&opener=1&url=").concat(t,"&redirect_uri=").concat(e),window.open(e,"_blank","menubar=no,location=no,width=576,height=768"),window.addEventListener("message",h,!1))}function w(t){return g.apply(this,arguments)}function g(){return(g=a(l.mark(function t(e){var n,r,o,a,i;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,jQuery.ajax({type:"POST",url:"".concat(wpApiSettings.root,"likecoin/v1/posts/").concat(wpApiSettings.postId,"/arweave/estimate"),method:"POST",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}});case 4:if(n=t.sent,r=n.ipfsHash,o=n.LIKE,a=n.memo,"0"===o||0===o)return i=n.arweaveId,f({ipfsHash:r,arweaveId:i}),t.abrupt("return");t.next=11;break;case 11:i=wpApiSettings,i=i.siteurl,i=encodeURIComponent(i),i="http://localhost:3000/in/widget/pay?to=like-arweave&amount=".concat(o,"&remarks=").concat(a,"&opener=1&redirect_uri=").concat(i),window.open(i,"_blank","menubar=no,location=no,width=576,height=768"),window.addEventListener("message",u,!1),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),console.log("error occured when trying to estimate LIKE cost: ".concat(t.t0));case 21:case"end":return t.stop()}},t,null,[[1,18]])}))).apply(this,arguments)}e=window.location.hash,n=document.getElementById("lcPublishRefreshBtn"),o=document.getElementById("lcISCNPublishBtn"),r=document.getElementById("lcArweaveUploadBtn"),"#likecoin_submit_iscn"===e&&setTimeout(function(){window.scrollTo(0,document.querySelector("#likecoin_submit_iscn").scrollHeight)},500),n&&n.addEventListener("click",i),o&&o.addEventListener("click",y),r&&r.addEventListener("click",w)}();
//# sourceMappingURL=likecoin_metabox.js.map
